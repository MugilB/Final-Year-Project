<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="header-content">
      <h1>Secure Voting Dashboard</h1>
      <div class="user-info">
        <span>Welcome, {{ currentUser.username }}!</span>
        <button class="btn btn-outline" (click)="refreshElections()" [disabled]="isLoading" title="Refresh Elections">
          <i class="fas fa-sync-alt" [class.fa-spin]="isLoading"></i>
          {{ isLoading ? 'Refreshing...' : 'Refresh' }}
        </button>
        <button class="btn btn-success" (click)="goToVote()" style="margin-right: 10px;">
          <i class="fas fa-vote-yea"></i> Cast Vote
        </button>
        <button class="btn btn-primary" *ngIf="isAdmin()" (click)="goToAdmin()">Admin Panel</button>
        <button class="btn btn-warning" (click)="goToAdmin()" style="margin-left: 10px;">Test Admin (Always Visible)</button>
        <button class="btn btn-info" (click)="testNavigation()" style="margin-left: 10px;">Test Navigation</button>
        <button class="btn btn-secondary" (click)="signOut()">Sign Out</button>
      </div>
    </div>
  </header>

  <main class="dashboard-main">
    <div class="welcome-section">
      <h2>Welcome to Secure Voting System</h2>
      <p>You are successfully logged in. This is your secure voting dashboard.</p>
      
      <div class="user-details">
        <h3>Your Account Information</h3>
        <div class="info-grid">
          <div class="info-item">
            <label>Username:</label>
            <span>{{ currentUser.username }}</span>
          </div>
          <div class="info-item">
            <label>Email:</label>
            <span>{{ currentUser.email }}</span>
          </div>
          <div class="info-item">
            <label>Role:</label>
            <span>{{ currentUser.roles?.join(', ') || 'User' }}</span>
          </div>
        </div>
      </div>
    </div>

    <div class="elections-section">
      <div class="elections-header">
        <h3>All Elections</h3>
        <button class="btn btn-secondary" (click)="refreshElections()" [disabled]="isLoading">
          <span *ngIf="isLoading" class="spinner"></span>
          {{ isLoading ? 'Loading...' : 'Refresh' }}
        </button>
      </div>

      <!-- Filter Tabs -->
      <div class="election-filters">
        <button 
          class="filter-btn" 
          [class.active]="selectedFilter === 'all'"
          (click)="onFilterChange('all')"
        >
          All Elections ({{ getFilterCount('all') }})
        </button>
        <button 
          class="filter-btn eligible" 
          [class.active]="selectedFilter === 'eligible'"
          (click)="onFilterChange('eligible')"
        >
          Eligible ({{ getFilterCount('eligible') }})
        </button>
        <button 
          class="filter-btn voted" 
          [class.active]="selectedFilter === 'voted'"
          (click)="onFilterChange('voted')"
        >
          Voted ({{ getFilterCount('voted') }})
        </button>
        <button 
          class="filter-btn pending" 
          [class.active]="selectedFilter === 'pending'"
          (click)="onFilterChange('pending')"
        >
          Pending ({{ getFilterCount('pending') }})
        </button>
        <button 
          class="filter-btn ended" 
          [class.active]="selectedFilter === 'ended'"
          (click)="onFilterChange('ended')"
        >
          Ended ({{ getFilterCount('ended') }})
        </button>
      </div>

      <div class="error-message" *ngIf="errorMessage">
        {{ errorMessage }}
      </div>

      <div class="elections-grid" *ngIf="!isLoading && getFilteredElections().length > 0">
        <app-election-card 
          *ngFor="let election of getFilteredElections()"
          [election]="election"
          [hasVoted]="hasUserVoted(election.electionId)"
        ></app-election-card>
      </div>

      <div class="no-elections" *ngIf="!isLoading && getFilteredElections().length === 0 && !errorMessage">
        <div class="no-elections-content">
          <h4>No Elections Found</h4>
          <p *ngIf="selectedFilter === 'all'">There are no elections available at this time.</p>
          <p *ngIf="selectedFilter === 'eligible'">There are currently no eligible elections for you to vote in.</p>
          <p *ngIf="selectedFilter === 'voted'">You haven't voted in any elections yet.</p>
          <p *ngIf="selectedFilter === 'pending'">There are no pending elections at this time.</p>
          <p *ngIf="selectedFilter === 'ended'">There are no ended elections to display.</p>
          <p>Check back later or contact your administrator for more information.</p>
        </div>
      </div>

      <div class="loading-elections" *ngIf="isLoading">
        <div class="loading-content">
          <div class="spinner-large"></div>
          <p>Loading elections...</p>
        </div>
      </div>
    </div>
  </main>
</div>
