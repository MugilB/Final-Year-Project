<div class="voting-wrapper">
  <!-- Dynamic Background Elements -->
  <div class="background-shapes">
    <div class="shape shape-1"></div>
    <div class="shape shape-2"></div>
    <div class="shape shape-3"></div>
    <div class="glass-grid"></div>
  </div>

  <main class="page-content">

    <!-- Loading State -->
    <div class="state-container" *ngIf="isLoading">
      <div class="spinner"></div>
      <p>Loading election details...</p>
    </div>

    <!-- Error State -->
    <div class="state-container error" *ngIf="error && !isLoading">
      <div class="error-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h3>Error Loading Election</h3>
      <p>{{ error }}</p>
      <button class="btn-primary" (click)="goBack()">Go Back</button>
    </div>

    <!-- Main Content -->
    <div class="voting-content" *ngIf="!isLoading && !error && election">

      <!-- Header / Hero -->
      <header class="election-hero">
        <button class="back-btn" (click)="goBack()">
          <i class="fas fa-arrow-left"></i> Back
        </button>

        <div class="hero-text">
          <span class="status-pill active">Active Election</span>
          <h1>{{ election.name }}</h1>
          <div class="meta-row">
            <span class="meta-item"><i class="far fa-calendar-alt"></i> Ends: {{ getFormattedDate(election.endDate)
              }}</span>
            <span class="meta-item time-remaining"><i class="far fa-clock"></i> {{ getTimeRemaining(election.endDate) }}
              remaining</span>
          </div>
        </div>
      </header>

      <!-- Candidates Grid -->
      <section class="candidates-section">
        <div class="section-header">
          <h2>Cast Your Vote</h2>
          <p>Select a candidate from the list below. Your vote is secure.</p>
        </div>

        <div class="candidates-list" *ngIf="candidates.length > 0">
          <div class="candidate-item" *ngFor="let candidate of candidates"
            [class.selected]="selectedCandidate?.candidateId === candidate.candidateId"
            (click)="selectCandidate(candidate)">

            <div class="item-left">
              <div class="avatar-box-sm">
                <span class="initial">{{ candidate.name.charAt(0) }}</span>
              </div>

              <div class="candidate-info-row">
                <h3 class="name">{{ candidate.name }}</h3>
                <div class="meta-tags">
                  <span class="tag party-tag">ID: {{ candidate.partyId }}</span>
                  <span class="tag ward-tag">Ward {{ candidate.wardId }}</span>
                </div>
              </div>
            </div>

            <div class="item-right">
              <div class="check-circle" *ngIf="selectedCandidate?.candidateId === candidate.candidateId">
                <i class="fas fa-check"></i>
              </div>

              <button class="select-btn-sm" [class.selected]="selectedCandidate?.candidateId === candidate.candidateId">
                {{ selectedCandidate?.candidateId === candidate.candidateId ? 'Selected' : 'Select' }}
              </button>
            </div>

          </div>
        </div>

        <!-- Empty State -->
        <div class="empty-state" *ngIf="candidates.length === 0">
          <div class="empty-icon"><i class="fas fa-users-slash"></i></div>
          <p>No candidates found for this election.</p>
        </div>
      </section>

      <!-- Floating Action Footer (Mobile/Desktop) -->
      <div class="vote-footer" [class.visible]="selectedCandidate">
        <div class="selection-summary">
          <span>Voting for:</span>
          <strong>{{ selectedCandidate?.name }}</strong>
        </div>
        <button class="btn-vote-confirm" (click)="openConfirmationCard()">
          Confirm Vote <i class="fas fa-chevron-right"></i>
        </button>
      </div>

    </div>
  </main>

  <!-- Confirmation Modal -->
  <div class="modal-overlay" *ngIf="showConfirmationCard" (click)="closeConfirmationCard()">
    <div class="modal-card" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Confirm Your Vote</h3>
        <button class="close-icon" (click)="closeConfirmationCard()"><i class="fas fa-times"></i></button>
      </div>

      <div class="modal-body" *ngIf="selectedCandidate">
        <div class="confirm-intro">
          You are about to cast your vote for:
        </div>

        <div class="candidate-highlight">
          <div class="lg-avatar">{{ selectedCandidate.name.charAt(0) }}</div>
          <div class="details">
            <h4>{{ selectedCandidate.name }}</h4>
            <p>Party ID: {{ selectedCandidate.partyId }} â€¢ Ward: {{ selectedCandidate.wardId }}</p>
          </div>
        </div>

        <div class="warning-box">
          <i class="fas fa-exclamation-circle"></i>
          <p>This action cannot be undone. Please confirm your choice.</p>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn-cancel" (click)="closeConfirmationCard()" [disabled]="isSubmitting">Cancel</button>
        <button class="btn-confirm" (click)="confirmVote()" [disabled]="isSubmitting">
          <span *ngIf="!isSubmitting">Submit Vote</span>
          <span *ngIf="isSubmitting"><i class="fas fa-spinner fa-spin"></i> Submitting...</span>
        </button>
      </div>
    </div>
  </div>

</div>