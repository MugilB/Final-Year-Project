<div class="candidate-management">
  <div class="section-header">
    <h1>Candidate Management</h1>
    <div class="header-actions">
      <button class="btn btn-primary" (click)="createCandidate()">
        <i class="fas fa-plus"></i>
        Add Candidate
      </button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters-section">
    <div class="filter-group">
      <label for="electionFilter">Filter by Election:</label>
      <select id="electionFilter" [(ngModel)]="selectedElectionFilter" class="filter-select">
        <option value="all">All Elections</option>
        <option *ngFor="let election of elections" [value]="election.electionId">
          {{ election.name }}
        </option>
      </select>
    </div>

    <div class="filter-group">
      <label for="statusFilter">Filter by Status:</label>
      <select id="statusFilter" [(ngModel)]="selectedStatusFilter" class="filter-select">
        <option value="all">All Statuses</option>
        <option value="PENDING">Pending</option>
        <option value="APPROVED">Approved</option>
        <option value="REJECTED">Rejected</option>
      </select>
    </div>

    <div class="filter-group">
      <label for="searchTerm">Search Candidates:</label>
      <input 
        type="text" 
        id="searchTerm" 
        [(ngModel)]="searchTerm" 
        placeholder="Search by name..."
        class="search-input">
    </div>

    <button class="btn btn-secondary" (click)="clearFilters()">
      <i class="fas fa-times"></i>
      Clear Filters
    </button>
  </div>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-state">
    <div class="spinner"></div>
    <p>Loading candidates...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !isLoading" class="error-state">
    <div class="error-message">
      <i class="fas fa-exclamation-triangle"></i>
      <p>{{ error }}</p>
      <button class="btn btn-primary" (click)="loadCandidates()">
        <i class="fas fa-retry"></i>
        Retry
      </button>
    </div>
  </div>

  <!-- Candidates Table -->
  <div *ngIf="!isLoading && !error" class="candidates-table-container">

    <div *ngIf="filteredCandidates.length === 0" class="empty-state">
      <i class="fas fa-users"></i>
      <h3>No candidates found</h3>
      <p *ngIf="selectedElectionFilter !== 'all' || searchTerm">
        Try adjusting your filters or search terms.
      </p>
      <p *ngIf="selectedElectionFilter === 'all' && !searchTerm">
        No candidates have been added yet. Click "Add Candidate" to get started.
      </p>
    </div>

    <div *ngIf="filteredCandidates.length > 0" class="table-wrapper">
      <table class="candidates-table">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Election</th>
            <th>Party ID</th>
            <th>Ward ID</th>
            <th>Status</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let candidate of filteredCandidates">
            <td>{{ candidate.candidateId }}</td>
            <td class="candidate-name">{{ candidate.name }}</td>
            <td>{{ getElectionName(candidate.electionId) }}</td>
            <td>{{ candidate.partyId || '-' }}</td>
            <td>{{ candidate.wardId || '-' }}</td>
            <td class="status-cell">
              <span class="status-badge" [ngClass]="getStatusClass(getCandidateStatus(candidate))">
                {{ getCandidateStatus(candidate) }}
              </span>
            </td>
            <td class="actions-cell">
              <!-- Show Edit/Delete buttons for non-PENDING candidates -->
              <ng-container *ngIf="getCandidateStatus(candidate) !== 'PENDING'">
                <button class="btn-edit" (click)="editCandidate(candidate)" title="Edit Candidate">
                  <i class="fas fa-edit"></i>
                  Edit
                </button>
                <button class="btn-delete" (click)="deleteCandidate(candidate)" title="Delete Candidate">
                  <i class="fas fa-trash"></i>
                  Delete
                </button>
              </ng-container>
              
              <!-- Show View Nomination button for PENDING candidates -->
              <ng-container *ngIf="getCandidateStatus(candidate) === 'PENDING'">
                <button class="btn-nomination" (click)="viewNomination(candidate)" title="View Nomination Form">
                  <i class="fas fa-user"></i>
                  View Nomination
                </button>
              </ng-container>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Candidate Modal -->
  <app-candidate-modal
    #candidateModal
    [isVisible]="showCandidateModal"
    [isEditMode]="isEditingCandidate"
    [candidate]="editingCandidate"
    [elections]="elections"
    [preselectedElectionId]="selectedElectionId"
    (close)="closeCandidateModal()"
    (save)="saveCandidate($event)">
  </app-candidate-modal>

  <!-- Nomination Details Modal -->
  <div *ngIf="showNominationModal" class="modal-overlay" (click)="closeNominationModal()">
    <div class="nomination-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Nomination Details</h3>
        <button class="close-btn" (click)="closeNominationModal()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="modal-content" *ngIf="selectedNominationCandidate">
        <div class="candidate-info">
          <div class="info-section">
            <h4>Personal Information</h4>
            <div class="info-grid">
              <div class="info-item">
                <label>Name:</label>
                <span>{{ selectedNominationCandidate.name }}</span>
              </div>
            <div class="info-item">
              <label>Email:</label>
              <span>{{ getCandidateEmail(selectedNominationCandidate) || 'Not provided' }}</span>
            </div>
            <div class="info-item">
              <label>Phone:</label>
              <span>{{ getCandidatePhone(selectedNominationCandidate) || 'Not provided' }}</span>
            </div>
            <div class="info-item">
              <label>Gender:</label>
              <span>{{ getCandidateGender(selectedNominationCandidate) || 'Not provided' }}</span>
            </div>
            <div class="info-item">
              <label>Age:</label>
              <span>{{ getCandidateAge(selectedNominationCandidate) || 'Not provided' }}</span>
            </div>
            <div class="info-item">
              <label>Address:</label>
              <span>{{ getCandidateAddress(selectedNominationCandidate) || 'Not provided' }}</span>
            </div>
            <div class="info-item" *ngIf="getCandidateImageLink(selectedNominationCandidate)">
              <label>Profile Image:</label>
              <a [href]="getCandidateImageLink(selectedNominationCandidate)!" target="_blank" class="document-link">
                <i class="fas fa-external-link-alt"></i>
                View Profile Image
              </a>
            </div>
            </div>
          </div>

          <div class="info-section">
            <h4>Election Information</h4>
            <div class="info-grid">
              <div class="info-item">
                <label>Election:</label>
                <span>{{ getElectionName(selectedNominationCandidate.electionId) }}</span>
              </div>
              <div class="info-item">
                <label>Party ID:</label>
                <span>{{ selectedNominationCandidate.partyId || 'Not specified' }}</span>
              </div>
              <div class="info-item">
                <label>Party Name:</label>
                <span>{{ getPartyName(selectedNominationCandidate.partyId) }}</span>
              </div>
              <div class="info-item">
                <label>Ward ID:</label>
                <span>{{ selectedNominationCandidate.wardId || 'Not specified' }}</span>
              </div>
              <div class="info-item">
                <label>Status:</label>
                <span>
                  Pending
                </span>
              </div>
            </div>
          </div>

          <div class="info-section" *ngIf="getCandidateBiography(selectedNominationCandidate)">
            <h4>Biography</h4>
            <p class="biography-text">{{ getCandidateBiography(selectedNominationCandidate) }}</p>
          </div>

          <div class="info-section" *ngIf="getCandidateManifesto(selectedNominationCandidate)">
            <h4>Manifesto Summary</h4>
            <p class="manifesto-text">{{ getCandidateManifesto(selectedNominationCandidate) }}</p>
          </div>

          <div class="info-section" *ngIf="getCandidateAadharLink(selectedNominationCandidate)">
            <h4>Documents</h4>
            <div class="info-item">
              <label>Aadhar Card:</label>
              <a [href]="getCandidateAadharLink(selectedNominationCandidate)!" target="_blank" class="document-link">
                <i class="fas fa-external-link-alt"></i>
                View Aadhar Card
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" (click)="closeNominationModal()">
          Close
        </button>
        <button class="btn btn-success" (click)="approveCandidate()" *ngIf="shouldShowApproveButton(selectedNominationCandidate)">
          <i class="fas fa-check"></i>
          {{ getApproveButtonText(selectedNominationCandidate) }}
        </button>
        <button class="btn btn-danger" (click)="rejectCandidate()" *ngIf="shouldShowRejectButton(selectedNominationCandidate)">
          <i class="fas fa-times"></i>
          {{ getRejectButtonText(selectedNominationCandidate) }}
        </button>
      </div>
    </div>
  </div>
</div>
